<script type="text/javascript">


    $(document).ready(function () {
      $(document).on("can_embed_submitted", function () {
        initStickyBtn(false);
      });

      $(document).on("can_embed_loaded", function () {
        var formTarget = $("#can_sidebar form");

        if ($("iframe").length) {
          var iframeID = $("iframe").parent().attr("id");
          if (iframeID.indexOf("fundraising") > -1) {
            setTimeout(function () {
              formTarget = $("#can_embed_iframe")
                .contents()
                .find("#can_main_col form");
              console.log(formTarget);
            }, 1000);
            $("footer").css("width", "100%");
            if ($(window).width() < 991) {
              var theTitle = $("h2.entry-title").remove();
              $("#can_embed_iframe").contents().find("body").append(theTitle);
            }
          }
        }

        setTimeout(function () {
          initStickyBtn(true);
          initOptOutModal();
        }, 1500);
      });
    });

    function initStickyBtn(enabled) {
      var submit = $("input[type=submit]");
      var stickyBtn = $("#sticky-button");
      var form = $("form");

      if (!enabled) {
        stickyBtn.remove();
        stickyBtn = null;
        return;
      }

      if (!form.length && $("#can_embed_iframe")) {
        form = $("#can_embed_iframe").contents().find("form");
        submit = $("#can_embed_iframe").contents().find("input[type=submit]");
      }

      if (!stickyBtn || !submit.length) return;
      if (submit.isInViewport()) {
        stickyBtn.fadeOut();
      } else {
        stickyBtn.fadeIn();
      }

      $("#sticky-button").click(function (e) {
        e.preventDefault();

        window.scrollTo({
          top: $(form).offset().top + 50,
          behavior: "smooth",
        });
      });

      window.addEventListener("scroll", () => {
        if (!stickyBtn || !submit.length) return;
        if (submit.isInViewport()) {
          stickyBtn.fadeOut();
        } else {
          stickyBtn.fadeIn();
        }
      });
    }

    $.fn.isInViewport = function () {
      const elementTop = $(this).offset().top;
      const elementBottom = elementTop + $(this).outerHeight();
      const viewportTop = $(window).scrollTop();
      const viewportBottom = viewportTop + $(window).height();
      return elementBottom > viewportTop && elementBottom < viewportBottom;
    };

    function initOptOutModal() {
      $("#can_embed_iframe")
        .contents()
        .find('input[name="subscription[group]"]')
        .change(function () {
          if ($(this).val() == "invalid") {
            popup_scripts($("#modal"));
          }
          $(this).data("shown", true);
        });

      $('input[name="subscription[group]"]').change(function () {
        if ($(this).val() == "invalid") {
          popup_scripts($("#modal"));
        }
        $(this).data("shown", true);
      });

      $("#modal button.subscribe").click(function () {
        $('input[name="subscription[group]"]:first').prop("checked", true);

        $("#can_embed_iframe")
          .contents()
          .find('input[name="subscription[group]"]:first')
          .prop("checked", true);

        $("#modal .close-button").click();
      });

      $("#modal .close-button").on("click", function () {
        $("#modal").hide();
        $("body").removeClass("lock");
        $("[role=navigation]").attr("aria-hidden", "false");
        $(".site-header a").attr("tabindex", "0");
        $(".site-header").css("display", "block");
        $(".site-header a").attr("style", "cursor:pointer;");
      });

      $("body").click(function (event) {
        if ($(event.target).is("#modal")) {
          $("#modal .close-button").click();
        }
      });
    }

    function popup_scripts(popup) {
      popup.data("save", $(this));
      $(".site-header a").attr("tabindex", "-1");
      $(".site-header").css("display", "none");
      $(".site-header a").attr("style", "cursor:default;");
      popup.attr("aria-hidden", "false");
      popup.css("display", "flex");
      $("body").addClass("lock");
      $(popup).find(".subscribe").focus();

      var frm = frames["can_embed_iframe"];
      var frmDoc = $(frm?.contentWindow?.document) || $(document);

      frmDoc.keydown(function (event) {
        if (event.keyCode == 27) {
          popup.find(".close").click();
        } else if (event.key == "Escape") {
          $("#modal .close-button").click();
        }
      });
    }



    </script>


    </div>




      <footer>
          <div class="margins-container">
            <img src="https://actionnetwork.org/user_files/user_files/000/079/813/original/ITF_LOGO_WHITE_2021.svg" alt="">
                    <span class="strap">The ITF fights passionately to improve the working lives of transport workers. We are the voice for nearly 20 million working people across nearly 700 member unions in 150 countries around the world.</span>
                    <div class="links">
                                                <a target="_blank" href="https://www.facebook.com/ITFglobal">Facebook</a>
                                                <a target="_blank" href="https://twitter.com/itfglobalunion"> Twitter</a>
                                                <a target="_blank" href="https://www.instagram.com/itfglobal/?hl=en"> Instagram</a>
                                        </div>
                    <span class="strap">© 2022 International Transport Workers’ Federation. All rights reserved</span>

          </div>
      </footer>

    <a class="button" href="#can_sidebar" id="sticky-button">Skip to action &darr;</a>
    <div id="modal">
      <div class="card">
          <h2>Are you sure you don't want to subscribe?</h2>
          <p>Are you sure you don't want to subscribe? We build powerful campaigns that improve the lives of millions of transport workers. But we can only make this change happen with help from thousands of people just like you. Will you subscribe to help win for working people?</p>
          <button class="subscribe">Okay, I'll subscribe</button>
          <div class="bottom-group">
            <p class="close-text">If you don't want to hear more about this campaign or our work via email close this prompt:</p>
            <button class="close-button" aria-label="close modal">Close</button>
          </div>
      </div>

    </div>



    </body>
    </html>
